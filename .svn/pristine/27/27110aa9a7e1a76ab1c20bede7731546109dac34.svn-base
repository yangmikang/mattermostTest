<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="apple-touch-icon" sizes="180x180" href="../../resources/img/guide/favicon_180.png">
	<link rel="icon" type="image/png" sizes="512x512" href="../../resources/img/guide/favicon_512.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="../../resources/img/guide/favicon_192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="../../resources/img/guide/favicon_32.png">
	<title>GINI - Global Innopolis Network Initiative</title>
	<link href="../../resources/css/swiper-bundle.min.css" type="text/css" rel="stylesheet" />
	<link href="../../resources/css/pattern_css.css" type="text/css" rel="stylesheet" />
	<link href="../../resources/css/output/p_common.css" type="text/css" rel="stylesheet" />
	<link href="../../resources/css/output/p_content.css" type="text/css" rel="stylesheet" />
	<link href="../../resources/css/output/p_layout.css" type="text/css" rel="stylesheet" />

	 <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/ko.global.min.js"></script>

</head>

<style>
.search-list .card-body {
    display: flex
;
    align-items: normal !important;
    justify-content: flex-start;
    flex-direction: column !important;
    gap: var(--krds-spacer-6);
}
.search-list .li {
    position: relative;
    display: flex
;
    align-items: normal !important;
    justify-content: flex-start;
    flex-direction: column !important;
    gap: var(--krds-spacer-6) 0;
    padding: var(--krds-spacer-6) !important;
    overflow-x: auto;
    box-sizing: border-box;
    border-radius: var(--krds-rd-12);
    border: 0.1rem solid var(--krds-gray-40);
	.type1{
		margin-bottom : 20px;
	
	}
	#content{
		    width: 80%;
    		margin: 0 auto;
			margin-bottom: 5%;
			margin-top: 2%;
	}
	 
	#btBox{
		 display: flex
;
   		 justify-content: flex-end;
   		 
   		 margin:10px;
	
	}
	.taxindate{
	    align-items: center;
		display: flex;
	}

	.topBox{
	
	    display: flex;
	    align-items: center;
	    justify-content: space-between;
	}
	
</style>
<body>
<div id="wrap">

		<div class="right ">
			<!-- <button type="button" class="btn-navi sch" title="통합검색 레이어" onclick="common.popupEvent('#popTotalSch');">통합검색</button> -->
		</div>
			<!-- //모바일 : 전체메뉴 -->
		<!-- //헤더 영역 -->

		<!-- 컨테이너 영역 -->
		<div id="container">
			<!-- breadcrumb -->
			<nav class="breadcrumb-wrap" aria-label="브레드크럼">
				<ol class="breadcrumb">
					<li class="home"><a href="#" class="txt">Home</a></li>
					<li><a href="#" class="txt">BOARD</a></li>
				</ol>
			</nav>
			<!-- breadcrumb -->
	<div class="inner">
	<!-- <button type="button" onclick="thumOn()">썸네일 온~~~~</button>
	<button type="button" onclick="listOn()">리스트 온~~~~</button>   -->
				<!-- 페이지 타이틀 영역 -->
				<div class="page-title-wrap">
					<h2 class="h-tit">GINI News</h2>
				</div>
				<!-- //페이지 타이틀 영역 -->
				<!-- 게시판목록 영역 -->
				 <div class="board-box">
					<!-- 검색 입력폼 -->
					<div class="search-top-box">
						<div class="sch-form-wrap flex">
							<div class="sch-input">
								<input type="hidden" id="edit_title" maxlength="100" class="form-control" autocomplete="on" placeholder="boardMasterCode" name="boardMasterCode" value="N02">
								<input type="text" class="form-control searchKeyword" placeholder="Enter Keyword" title="Enter Keyword"
								name="searchKeyword" id="searchKeyword">
								<button type="button" class="btn btn-ico ico-sch" id="search">
									<span class="sr-only">검색</span>
								</button>
							</div>
							<button type="button" class="btn btn-txt primary" style="width: 150px;" onclick="location.href='${pageContext.request.contextPath}//board/boardPage.do'">Write Post</button>
						</div>
					</div>
					<!-- //검색 입력폼 -->
					<!-- 검색 결과 : 리스트 상단 -->
					 <div class="search-list-top type1">
						<div class="sch-info" role="region" aria-live="polite">
							전체 <span class="keyword">00</span>건
						</div>
					</div>
					<!-- //검색 결과 : 리스트 상단 -->
				<!-- 검색 결과 : 이미지 -->
				 	<ul class="search-list type2" style="display:none; ">
					
					
					</ul> 
					<!-- 검색 결과 : 리스트 -->
				 	<ul class="search-list type1 stb">
					</ul> 
					<!-- //검색 결과 : 리스트 -->

					

					<!-- paging : 웹 -->
					<div class="pagination w-page paging">
						<div class="row justify-content-center" id="divPagingArea">
					
						</div>
				</div>
					</div>
					</div>
					<!-- //paging : 웹 -->

	<!-- 레이어 : 검색필터 -->
	<!-- //레이어 : 검색필터 -->

	<!-- 스크립트 : 라이브러리 -->
	<script src="../../resources/js/pattern/jquery.min.js"></script>
	
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<!-- 스크립트 : 패턴 페이지 -->
	
	<script src="../../resources/js/pattern/ui-pattern-script.js"></script>
	

	<!-- 스크립트 : 컴포넌트 -->
	<script src="../../resources/js/component/ui-script.js"></script>
	<script>
	
	</script>

	<script>
	function listOn() {
		let type2 = document.querySelector(".type2");
		let stb = document.querySelector(".stb");

		type2.style.display = 'none';
		stb.style.display = 'grid';

		//localStorage.setItem("viewMode", "list");
	}


	
	function thumOn(){
		let type2 = document.querySelector(".type2")
		type2.style.display = 'grid'; 
		type2.style.gridTemplateColumns = '1fr 1fr 1fr'; 
		type2.style.gridGap = 'var(--krds-spacer-6)'; 
		let stb = document.querySelector(".stb")
		stb.style.display = 'none';  
		
		//localStorage.setItem("viewMode", "thumbnail"); // 모드 저장
		
	}
	document.getElementById("search").addEventListener("click", function () {
		
		  const keyword = document.getElementById("searchKeyword").value;
			console.log("keyword",keyword)
		  changeSort(1, keyword); // 검색 시 1페이지부터 다시 시작
		});
	document.addEventListener("DOMContentLoaded", function () {
		const savedMode = localStorage.getItem("viewMode");

		if (savedMode === "thumbnail") {
			thumOn(); // 저장된 모드가 썸네일이면 자동 실행
		}

		changeSort(); // 목록 데이터 로드
	});


	changeSort()

	function changeSort(currentPage = 1, keyword) {
		let boardMasterCode = 'N01'
		let data = { currentPage: currentPage, keyword:keyword ,boardMasterCode:boardMasterCode};

	  axios.post('\${pageContext.request.contextPath}/board/listAjax.do', data)
	    .then(function (res) {
	      let content = document.querySelector(".stb");
	      let type2 = document.querySelector(".type2");
	      let Listdata = res.data.content;
	      let tby = '';
	      let tby2 = '';
	      let tby3 = '';
			let getTotal = res.data.total
			console.log(getTotal)
			

			let flagIcon = '';

			

			let totalkeyword = document.querySelector(".keyword")
			totalkeyword.innerText = getTotal
			

			        	 for (let list of Listdata) {
			        		  console.log("list", list);
			        		  if (list.boardMasterCode !== 'N01') continue;

			        		  // 국기 아이콘 처리
			        		  switch (list.cityCode) {
			        		    case "01": flagIcon = 'ico_korea.svg'; break;
			        		    case "02": flagIcon = 'ico_germany.svg'; break;
			        		    case "03": flagIcon = 'ico_spain.svg'; break;
			        		    case "04": 
			        		    case "05": flagIcon = 'ico_usa.svg'; break;
			        		    default: flagIcon = ''; break;
			        		  }

			        		  // 대표 이미지 처리
			        		  let fileList = list.fileGroupVO?.fileDetailVOList ?? [];
			        		  let thumbnailFiles = fileList.filter(f => f.fileType === 'THUMBNAIL');
			        		  let firstFile = thumbnailFiles.length > 0 ? thumbnailFiles[0] : null;

			        		  let fileImgTag = firstFile
			        		    ? `<img class="img-fluid imgFileSaveLocate"
			        		           src="\${pageContext.request.contextPath}//\${firstFile.fileSaveLocate}"
			        		           alt="\${firstFile.fileOriginalName}"
			        		           style="cursor: pointer; display: block;" />`
			        		    : `<img class="img-fluid imgFileSaveLocate"
			        		           src="\${pageContext.request.contextPath}/resources/upload/2025/07/11/noimg.png"
			        		           alt="No Image"
			        		           style="cursor: pointer; display: block;" />`;

			        		  tby3 += `
			        		    <li class="li">
			        			    <div class="card-img" style="background-image:url('\${pageContext.request.contextPath}/\${firstFile?.fileSaveLocate || 'img/no-image.png'}')"
			        		         onclick="location.href='\${pageContext./board/detail.do?boardCode=\${list.boardCode}'"> </div>
			        		      <div class="card-body" onclick="location.href='\${pageContext.request.contextPath}/board/detail.do?boardCode=${list.boardCode}'">
			        		        <a href="#" class="c-text">
			        		          <p class="c-tit"><span class="span">\${list.title}</span></p>
			        		          <p class="c-txt">\${list.content.length > 100 ? list.content.slice(0, 100) + '...' : list.content}</p>
			        		          <p class="c-date">
			        		            <strong class="key">Created Date</strong>
			        		            <span class="value">\${list.regDate}</span>
			        		          </p>
			        		        </a>
			        		        <div class="c-btn">
			        		          <a href="#" class="btn md secondary" title="View Details" onclick="location.href='\${pageContext.request.contextPath}/board/detail.do?boardCode=${list.boardCode}'">View Details</a>
			        		        </div>
			        		      </div>
			        		    </li>
			        		  `;
			        		}

	      type2.innerHTML = tby3;

	      document.querySelector("#divPagingArea").innerHTML = res.data.pagingArea;
	      bindPagingEvents(); //  새 페이징에 이벤트 다시 바인딩
	    });
	}
	function bindPagingEvents() {
		  document.querySelectorAll(".clsPagingArea").forEach(function (el) {
		    el.addEventListener("click", function (e) {
		      e.preventDefault();
		      const currentPage = parseInt(this.dataset.currentPage);
		      const keyword = this.dataset.keyword || '';
		      console.log(":page",currentPage)
		      changeSort(currentPage, keyword);
		    });
		  });
		}
	</script>

</body>
</html>