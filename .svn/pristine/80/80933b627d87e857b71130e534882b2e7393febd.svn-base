<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>

<body>
<div id="container">
	<div class="page-title-wrap visual img-joint">
		<div class="visual-filter"></div>
			<div class="inner">
				<!-- breadcrumb -->  
					<nav class="breadcrumb-wrap" aria-label="브레드크럼">
						<ol class="breadcrumb">
							<li class="home"><a href="#" class="txt">Home</a></li>
							<li><a href="#" class="txt">User Usage Statistics</a></li>
						</ol>
					</nav>
					<!-- breadcrumb --> 
					<!-- 페이지 타이틀 영역 -->  
					<div class="visual-area">
						<h2 class="h-tit">User Usage Statistics</h2>
					</div>  
				<!-- //페이지 타이틀 영역 -->
					
				</div>
			</div>
<!-- 로그인 영역 -->
<div class="inner">
	<div class="conts-area">
		<div class="conts-wrap">
			<div class="box-white">
				    <div class="tab-cont-box"> 
				    	<table class="tbl col data">
						   <thead>
							  <tr>
							    <th>No.</th>
							    <th>Log Month</th>
							    <th>Request Count</th>
							  </tr>
							</thead>

						    <tbody id="statTbody">
								  
						    </tbody>
						</table>  
					</div>
				    <div class="tab-cont-box"> 
				    	<table class="tbl col data">
						   <thead>
							  <tr>
							    <th>No.</th>
							    <th>Log Date</th>
							    <th>Request Count</th>
							  </tr>
							</thead>

						    <tbody id="dailyTbody">
								  
						    </tbody>
						</table>  
					</div>
				    <div class="tab-cont-box"> 
				    	<table class="tbl col data">
						   <thead>
							  <tr>
							    <th>No.</th>
							     <th>Role</th>
							    <th>Log Date</th>
							    <th>Request Count</th>
							  </tr>
							</thead>

						    <tbody id="dailyByRoleTbody">
								  
						    </tbody>
						</table>  
					</div>
				    <div class="tab-cont-box"> 
				    	<table class="tbl col data">
						   <thead>
							  <tr>
							    <th>No.</th>
							    <th>Role</th>
							    <th>log Month</th>
							    <th>Request Count</th>
							  </tr>
							</thead>

						    <tbody id="monthlyByRoleTbody">
								  
						    </tbody>
						</table>  
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
 <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
	
	 const contextPath = '${pageContext.request.contextPath}';
		
  axios.get(`${contextPath}/monthlyTotal.do`)
    .then(res => {
      const data = res.data;
      const tbody = document.querySelector("#statTbody");
      tbody.innerHTML = '';

      let tby =''
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No data found</td></tr>';
        return;
      }

      data.forEach((row, idx) => {
    	  tby += 
        	  '<tr>' +
    		    '<th scope="row">' + row.rnum + '</th>' +
    		    '<th>' + row.logMonth + '</th>' +
    		    '<th>' + row.requestCount + '</th>' +
    		  '</tr>';
        tbody.innerHTML = tby;
      });
    })
    .catch(err => {
      console.error("Failed to fetch stats:", err);
      document.getElementById("statTbody").innerHTML = 
        '<tr><td colspan="4" style="text-align:center; color:red;">Error loading data</td></tr>';
    });
		
  axios.get(`${contextPath}/dailyTotal.do`)
    .then(res => {
      const data = res.data;
      const tbody = document.querySelector("#dailyTbody");
      tbody.innerHTML = '';

      let tby =''
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No data found</td></tr>';
        return;
      }

      data.forEach((row, idx) => {
    	  tby += 
        	  '<tr>' +
    		    '<th scope="row">' + row.rnum + '</th>' +
    		    '<th>' + row.logDate + '</th>' +
    		    '<th>' + row.requestCount + '</th>' +
    		  '</tr>';
        tbody.innerHTML = tby;
      });
    })
    .catch(err => {
      console.error("Failed to fetch stats:", err);
      document.getElementById("statTbody").innerHTML = 
        '<tr><td colspan="4" style="text-align:center; color:red;">Error loading data</td></tr>';
    });
  axios.get(`${contextPath}/dailyByRole.do`)
    .then(res => {
      const data = res.data;
      const tbody = document.querySelector("#dailyByRoleTbody");
      tbody.innerHTML = '';

      let tby =''
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No data found</td></tr>';
        return;
      }

      data.forEach((row, idx) => {
    	  tby += 
    	  '<tr>' +
		    '<th scope="row">' + row.rnum + '</th>' +
		    '<th>' + row.role + '</th>' +
		    '<th>' + row.logDate + '</th>' +
		    '<th>' + row.requestCount + '</th>' +
		  '</tr>';
        tbody.innerHTML = tby;
      });
    })
    .catch(err => {
      console.error("Failed to fetch stats:", err);
      document.getElementById("statTbody").innerHTML = 
        '<tr><td colspan="4" style="text-align:center; color:red;">Error loading data</td></tr>';
    });
  axios.get(`${contextPath}/monthlyByRole.do`)
    .then(res => {
      const data = res.data;
      const tbody = document.querySelector("#monthlyByRoleTbody");
      tbody.innerHTML = '';

      let tby =''
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No data found</td></tr>';
        return;
      }

      data.forEach((row, idx) => {
    	 tby += 
    		  '<tr>' +
    		    '<th scope="row">' + row.rnum + '</th>' +
    		    '<th>' + row.role + '</th>' +
    		    '<th>' + row.logMonth + '</th>' +
    		    '<th>' + row.requestCount + '</th>' +
    		  '</tr>';

        tbody.innerHTML = tby;
      });
    })
    .catch(err => {
      console.error("Failed to fetch stats:", err);
      document.getElementById("statTbody").innerHTML = 
        '<tr><td colspan="4" style="text-align:center; color:red;">Error loading data</td></tr>';
    });
});
</script>
</body>
