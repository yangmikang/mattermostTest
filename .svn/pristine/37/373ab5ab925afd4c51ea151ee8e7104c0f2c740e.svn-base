<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/ko.global.min.js"></script>
<!--     <div id="calendar" style="max-width:900px; margin: 0 auto;"></div> -->

<!--     <h3>Add Event</h3> -->
<%--     <form action="\${pageContext.request.contextPath}/calendar/addEvent.do" method="post"> --%>
<!--         Title: <input type="text" name="title" required><br> -->
<!--         DateTime: <input type="datetime-local" name="eventDatetime" required><br> -->
<!--         Description: <input type="text" name="description"><br> -->
<!--         <button type="submit">Add</button> -->
<!--     </form> -->
  
<style>
 .search-list .card-body .c-text:hover{
  background-color: transparent !important;
  box-shadow: none !important;
  border: none !important;
  outline: none !important;
  text-decoration: none !important;
}

</style>
<div id="container">
			<!-- breadcrumb -->
			<div class="page-title-wrap visual img-members">
				<div class="visual-filter"></div>
				<div class="inner">
					<!-- breadcrumb -->
					<nav class="breadcrumb-wrap" aria-label="브레드크럼">
						<ol class="breadcrumb">
							<li class="home"><a href="#" class="txt">Home</a></li>
							<li><a href="#" class="txt">Programs</a></li>
							<!-- <li><a href="#" class="txt">Overview</a></li> -->
						</ol>
					</nav>
					<!-- breadcrumb -->
					<div class="visual-area">
						<h2 class="h-tit">Events</h2>
						<p>Schedule of Events</p>
					</div>
				</div>
			</div>
	

			<!-- 컨텐츠 영역 -->
			<div class="inner">
				<!-- 페이지 타이틀 영역 -->
				<!-- //페이지 타이틀 영역 -->
				<!-- 행사 일정 캘린더 영역 시작 -->
				 <div class="Schedule-wrap">
					<div id="calendar" class="Schedule-left-box">
						<div class="calender-top_area"></div>
						<div class="calender-bottom-area">달력 영역</div>
					</div>
					<div class="Schedule-right-box">
						<div class="today-tit-wrap">
						<h2>
						<span id="todayFullDate" class="tit"></span>
						  <span id="todayDay" class="tit"></span>
						  <span id="todayDate" class="tit-date"></span>
						</h2>
						
						</div>
						<div class="event-list-wrap">
							<div class="gini-cont-wrap clickCalendar" style="display:block !important;">
								<h4 class="cont-tit-large green-circle text-line">일정을 선택해주세요</h4>
							</div>
							<div class="gini-cont-wrap ongoingCont" style="display:none !important;">
								<h4 class="cont-tit-large green-circle text-line">Ongoing</h4>
							</div>
							<div class="event-list-box ongoing"></div>
							<!-- 이벤트 없을 때  적용-->
							<!-- <div class="no-event">
								<p class="no-event-ico">There are no event schedules.</p>
							</div> -->
							<!-- //이벤트 없을 때  적용-->
							<div class="gini-cont-wrap upcomingCont" style="display:none !important;">
								<h4 class="cont-tit-large light-green-circle text-line">Upcoming</h4>
							</div>
							<div class="event-list-box upcoming"></div>
						</div>
						<div class="btn-wrap pc-only">
							<button type="button" class="btn primary" onclick="location.href='${pageContext.request.contextPath}/calendarCreate.do'">Register</button>
						</div>
					</div>


				 </div>
				<!-- //검색 결과 : 리스트 상단 -->

				<!-- 한달 전체 행사 리스트  -->
				<ul class="search-list type1">
					<li class="li">
						<div class="in">
							<!-- 행사 진행상태 -->
							<div class="card-top">
								<span class="krds-badge bg3">Ongoing</span>
								<span class="krds-badge">Upcoming</span>
								<span class="krds-badge bg2">Completed</span>
							</div>
							<!-- //행사 진행상태-->
							<div class="card-body">
								<a href="#" class="c-text">
									<p class="c-tit"><span class="span">행사 제목</span></p>
									<p class="c-txt">
										행사 상세 설명 영역입니다.
									</p>
									<p class="c-date">
										<strong class="key"></strong>
										<span class="value">2026.00.00-2026.00.00</span>
									</p>
								</a>
								<div class="c-btn">
									<a href="#" class="btn md secondary" title="자세히 보기">자세히 보기</a>
								</div>
							</div>
							<!-- 해시태그 키워드 영역 시작-->
							<div class="card-btm">
								<span class="tag">대전</span>
								<span class="tag">도르트문트</span>
							</div>
							<!-- //해시태그 키워드 영역 -->
						<!-- 	<div class="card-btn">
								<button type="button" class="btn sm btn-txt ico-down ico-before" title="첨부파일">첨부파일</button>
								<button type="button" class="btn sm btn-txt ico-go ico-before" title="하이퍼링크">하이퍼링크</button>
							</div> -->
						</div>
					</li>
				</ul>
				<!-- //한달 전체 행사 리스트 -->

				<!-- paging : 웹 -->
			<div class="pagination w-page paging">
						<div class="row justify-content-center" id="divPagingArea">
					
						</div>
				</div>
				<!-- //paging : 웹 -->

				<!-- paging : 모바일 -->
				<div class="pagination m-page">
					<div class="page-navis">
						<a class="page-navi prev" href="#">이전</a>
						<a class="page-navi next" href="#">다음</a>
					</div>
					<div class="page-links">
						<a class="page-link" href="#">1</a>
						<span class="page-link link-dot"></span>
						<a class="page-link" href="#">7</a>
						<a class="page-link active" href="#">8</a>
						<a class="page-link" href="#">9</a>
						<span class="page-link link-dot"></span>
						<a class="page-link" href="#">120</a>
					</div>
				</div>
				<!-- 일정 등록 모달 -->
			<div id="calendarModal" style="display:none; position:fixed; top:4%; left:50%; transform:translateX(-50%); width:70%; background:#fff; border:1px solid #ccc; padding:20px; z-index:1000;">
			    <!-- <h3>일정 등록</h3>
			    <label>제목 <input type="text" id="modalTitle" class="form-control" /></label><br><br>
			    <label>시작일 <input type="date" id="modalStart" class="form-control" /></label><br><br>
			    <label>종료일 <input type="date" id="modalEnd" class="form-control" /></label><br><br>
			    <label>링크 <input type="text" id="modalLink" class="form-control" /></label><br><br>
			    <label>썸네일 <input type="text" id="modalThumb" class="form-control" /></label><br><br>
			    <div style="text-align:right;">
			        <button onclick="registerEvent()" class="btn primary">저장</button>
			        <button onclick="closeModal()" class="btn">취소</button>
			    </div> -->
					<!-- 일정등록 폼 -->
				 <div class="gini-cont-wrap">
					<div class="gini-cont-box">
						<div class="row cont100">
							<!-- 폼그룹 left -->
							<div class="cont-left cont50">
								<!-- 폼그룹 -->
								<div class="form-group">
									<div class="form-tit">
										<label for="consult_name">Event Title</label>
									</div>
									<div class="form-conts">
										<input type="text" id="consult_name" class="form-control" placeholder="Event Title">
									</div>
								</div>
								<!-- //폼그룹 -->
								<!-- 날짜 입력 필드 폼그룹 -->
							<div>
								<div class="form-group">
									<div class="form-tit">
										<label for="cal">Start Date & Time</label>
									</div>
									<div class="form-conts form-row">
										<div class="form-conts datepicker-conts">
											<div class="datepicker-input">
											 <input type="date" id="modalStart" class="form-control" />
												<!-- <input type="number" class="form-control  datepicker cal" placeholder="Select date" id="cal"> -->
												<button type="button" class="form-btn-datepicker">
													<span class="sr-only">달력 열기</span>
												</button>
											</div>
										</div>
										<!-- <div class="form-conts">
											<input type="text" id="consult_name" class="form-control" placeholder="Select time">
										</div> -->
									</div>
								</div>
								<!-- //날짜 입력 필드 폼그룹 -->
								<!-- 날짜 입력 필드 폼그룹 -->
								<div class="form-group">
									<div class="form-tit">
										<label for="cal">End Date & Time</label>
									</div>
									<div class="form-conts form-row">
										<div class="form-conts datepicker-conts">
											<div class="datepicker-input">
											 <input type="date" id="modalEnd" class="form-control" />
												<!-- <input type="number" class="form-control  datepicker cal" placeholder="Select date" id="cal">
												<button type="button" class="form-btn-datepicker">
													<span class="sr-only">달력 열기</span>
												</button> -->
											</div>
										</div>
										<!-- <div class="form-conts">
											<input type="text" id="consult_name" class="form-control" placeholder="Select time">
										</div> -->
									</div>
								</div>
								<!-- //날짜 입력 필드 폼그룹 -->
								<!-- 폼그룹 -->
								<!-- <div class="form-group">
									<div class="form-tit">
										<label for="">Contact</label>
									</div>
									<div class="form-conts">
										<input type="tel" id="" class="form-control" placeholder="Contact">
									</div>
								</div> -->
								<!-- //폼그룹 -->
								<div class="form-group margin-b">
									<div class="form-tit lg">
										<label for="">Upload Thumbnail</label>
									</div>
									<div class="form-conts row">
										<input id="userId" type="text" maxlength="16" class="form-control">
										<button type="button" class="btn lg secondary"> Search </button>
									</div>
									<p class="form-hint info"> 00 byte까지 허용 </p>
								</div>
							</div>
							<!-- //폼그룹 left -->
							<!-- cont-right -->
							<div class="cont-right cont50">
								<!-- 폼그룹 -->
								<div class="form-group">
									<div class="form-tit">
										<label for="consult_name">Event Description</label>
									</div>
									<div class="form-conts">
										<input type="text" id="description" value="" class="form-control" placeholder="Event Description">
									</div>
								</div>
								<!-- //폼그룹 -->
								<!-- 폼그룹 -->
								<div class="form-group">
									<div class="form-tit">
										<label for="consult_name">Organizer</label>
									</div>
									<div class="form-conts">
										<select class="form-select lg" id="citySelect" title="선택" onchange="getcityVal()">
											<option value="GINI">GINI</option>
											<option value="City of Daejeon">City of Daejeon</option>
											<option value="City of Dortmund">City of Dortmund</option>
											<option value="City of Malaga">City of Malaga</option>
											<option value="County of Montgomery, MD">County of Montgomery, MD</option>
											<option value="City of Seattle">City of Seattle</option>
											<option value="Province of Quebec">Province of Quebec</option>
										</select>
									</div>
								</div>
								<!-- //폼그룹 -->
						<!-- 		<div class="form-group">
									<div class="form-tit">
										<label for="consult_name">Location</label>
									</div>
									<div class="form-conts">
										<input type="text" id="" class="form-control" placeholder="Location 넣을지 말지 협의 필요">
									</div>
								</div> -->
								<div class="form-group">
									<div class="form-tit">
										<label for="consult_name">External Link</label>
									</div>
									<div class="form-conts">
										<input type="text" id="" class="form-control" placeholder="https://example.com">
									</div>
								</div>
								<div class="form-group chk-area">
									<div class="form-tit">
										<label for="consult_name">Event Status</label>
									</div>
									<div class="form-conts form-row">
										<div class="form-check lg">
											<input type="radio" name="" id="" checked>
											<label for="">Upcoming</label>
										</div>
										<div class="form-check lg">
											<input type="radio" name="" id="">
											<label for="">Ongoing</label>
										</div>
									</div>
								</div>
								<!-- //폼 끝 -->
								</div>
							</div>
							<!-- //cont-right -->
						</div>
					</div>

					<div class="gini-cont-box">
						<div class="row">
							<!-- 파일업로드 -->
							<div class="file-upload cont50">
								<p class="txt">첨부할 파일을 여기에 끌어다 놓거나, 파일 선택 버튼을 눌러 파일을 직접 선택해주세요.</p>
								<button type="button" class="btn primary ico-before ico-upload md" onclick="uploadFiles()">파일선택</button>
							</div>
							<!-- //파일업로드 -->
							<!-- 파일업로드 -->
							<div class="file-upload-result cont50">
								<div class="upload-top">
									<div class="file-total"><span class="current">3개</span> / 6개(몇개로 할지 협의 필요)</div>
								</div>
								<ul class="upload-list">
									<li>
										<div class="in">
											<div class="file-name">파일 제목1 [hwp, 17KB]</div>
											<div class="file-btn">
												<button type="button" class="btn btn-txt ico-before ico-del sm h-auto">삭제</button>
											</div>
										</div>
									</li>
									<li class="is-error">
										<div class="in">
											<div class="file-name">파일 제목2 [hwp, 17KB]</div>
											<div class="file-btn">
												<span class="ico-invalid error">
													<em class="sr-only">에러</em>
												</span>
												<button type="button" class="btn btn-txt ico-before ico-del sm h-auto">삭제</button>
											</div>
										</div>
										<p class="file-hint">
											등록 가능한 파일 용량을 초과하였습니다.<br>
											20MB 미만의 파일만 등록할 수 있습니다. 
										</p>
									</li>
									<li>
										<div class="in">
											<div class="file-name">파일 제목1 [hwp, 17KB] </div>
											<div class="file-btn">
												<span class="spinner"></span>
											</div>
										</div>
									</li>
									<li>
										<div class="in">
											<div class="file-name">파일 제목2 [hwp, 17KB] </div>
											<div class="file-btn">
												<span class="ico-invalid ok">
													<em class="sr-only">정상</em>
												</span>
											</div>
										</div>
									</li>
									<!-- <li>
										<div class="in">
											<div class="file-name">파일 제목3 [hwp, 17KB] </div>
											<div class="file-btn">
												<button type="button" class="btn btn-txt ico-before ico-del sm h-auto">삭제</button>
											</div>
										</div>
									</li>
									<li>
										<div class="in">
											<div class="file-name">파일 제목4 [hwp, 17KB] </div>
											<div class="file-btn">
												<button type="button" class="btn btn-txt ico-before ico-del sm h-auto">삭제</button>
											</div>
										</div>
									</li> -->
								</ul>
								<div class="upload-delete-btn">
									<button type="button" class="btn btn-txt ico-before ico-del sm h-auto">전체 파일 삭제</button>
								</div>
							</div>
							<!-- //파일업로드 리스트 -->
				<div style="text-align:right;">
			        <button onclick="registerEvent()" class="btn primary">저장</button>
			        <button onclick="closeModal()" class="btn">취소</button>
			    </div> 
						</div>
					</div>
				 </div>
				<!-- //일정등록 폼 -->
			
			</div>
			<div id="modalOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; opacity:0.5; z-index:999;"></div>
				
				<!-- //paging : 모바일 -->
			</div>
			<!-- //컨텐츠 영역 -->
		</div>
		<!-- 일정 수정 모달 -->
			<div id="calendarUdModal" style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%); width:400px; background:#fff; border:1px solid #ccc; padding:20px; z-index:1000;">
				
			
			</div>
			
			<div id="modalUdOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; opacity:0.5; z-index:999;"></div>
				
				<!-- //paging : 모바일 -->
			</div>
			<!-- //컨텐츠 영역 -->
		
		</div>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
    
    
	let calendar;
	let allEvents = [];
	let currentMonthStart = null;
	let currentMonthEnd = null;
	document.addEventListener("DOMContentLoaded", function() {
		  const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
		  const today = new Date();

		  const year = today.getFullYear();
		  const month = (today.getMonth() + 1).toString().padStart(2, '0');
		  const date = today.getDate().toString().padStart(2, '0');
		  const day = dayNames[today.getDay()];

		  const fullDateStr = year + "." + month + "." + date + " (" + day + ")";
		  document.getElementById("todayFullDate").textContent = fullDateStr;
		});


	function formatDateString(dateInput) {
		  const date = new Date(dateInput);
		  if (isNaN(date)) return "-";
		  const year = date.getFullYear();
		  const month = (date.getMonth() + 1).toString().padStart(2, "0");
		  const day = date.getDate().toString().padStart(2, "0");
		  return `\${year}.\${month}.\${day}`; 
		}
	document.addEventListener('DOMContentLoaded', function () {
		  const calendarEl = document.getElementById('calendar');

		  calendar = new FullCalendar.Calendar(calendarEl, {
		    locale: 'en',
		    initialView: 'dayGridMonth',
		    selectable: false,
		    editable: false,
		    headerToolbar: {
		      left: 'title',
		      right: 'prev today next'
		    },

		    datesSet: function (info) {
		      currentMonthStart = info.startStr;
		      currentMonthEnd = info.endStr;
		      loadCalendarList(1);
		    },

		    events: function (info, successCallback) {
		      fetch('${pageContext.request.contextPath}/calendar/events.do')
		        .then(function (response) {
		          return response.json();
		        })
		        .then(function (data) {
		          const mappedEvents = data.map(function (ev) {
		            const fileList = ev.vo.fileGroupVO && ev.vo.fileGroupVO.fileDetailVOList ? ev.vo.fileGroupVO.fileDetailVOList : [];
		            console.log("fileList@#@#@#@#@#", fileList);
		            return {
		              id: ev.id,
		              title: ev.title,
		              start: new Date(ev.start),
		              end: new Date(ev.end),
		              extendedProps: {
		                eventDescription: ev.description,
		                organizer: ev.organizer,
		                eventStatus: ev.eventStatus ? ev.eventStatus.toUpperCase() : "",
		                location: ev.location,
		                contact: ev.contact,
		                fileDetailVOList: fileList
		              }
		            };
		          });

		          allEvents = mappedEvents;
		          successCallback(mappedEvents);
		          displayTodayEvents();
		        });
		    }
		  });

		  calendar.render();
		});

		function loadCalendarListByMonth(startDateISO, endDateISO) {
		  axios.post('${pageContext.request.contextPath}/calendar/listAjax.do', {
		    startDate: startDateISO,
		    endDate: endDateISO,
		    currentPage: 1
		  }).then(function (res) {
		    console.log("월간 일정 조회 결과", res.data);
		  }).catch(function (err) {
		    console.error("loadCalendarListByMonth 오류:", err);
		  });
		}


	
	function loadCalendarListByMonth(startDateISO, endDateISO) {
		  axios.post('${pageContext.request.contextPath}/calendar/listAjax.do', {
		    startDate: startDateISO,
		    endDate: endDateISO,
		    currentPage: 1
		  }).then(res => {
		    console.log("월간 일정 조회 결과", res.data);
		  }).catch(err => {
		    console.error("loadCalendarListByMonth 오류:", err);
		  });
		}

	function registerEvent() {
	  const title = document.getElementById("consult_name").value;
	  const start = document.getElementById("modalStart").value;
	  const end = document.getElementById("modalEnd").value;
	  const citySelect = document.getElementById("selectOrg");
	  const cityValue = citySelect.value;
	  const description = document.getElementById("description").value;
	
	  if (!title || !start || !end) {
	    alert("모든 항목을 입력하세요.");
	    return;
	  }
	
	  const eventData = {
	    eventTitle: title,
	    startDatetime: start + 'T00:00:00',
	    endDatetime: end + 'T23:59:59',
	    eventDescription: description,
	    organizer: cityValue,
	    location: '',
	    contact: '',
	    uploadThumbnail: '',
	    externalLink: '',
	  };
	
	  axios.post('${pageContext.request.contextPath}/calendar/register.do', eventData)
	    .then(response => {
	      const saved = response.data;
	      calendar.addEvent({
	        id: saved.id,
	        title: saved.eventTitle,
	        start: saved.startDatetime,
	        end: saved.endDatetime,
	        allDay: true
	      });
	      closeModal();
	      alert('일정이 등록되었습니다.');
	    })
	    .catch(error => {
	      console.error('등록 오류:', error);
	      alert('일정 등록 실패');
	    });
	}
	function loadCalendarList(currentPage) {
		  if (typeof currentPage === 'undefined') currentPage = 1;

		  if (!currentMonthStart || !currentMonthEnd) return;

		  const data = {
		    currentPage: currentPage,
		    startDate: currentMonthStart,
		    endDate: currentMonthEnd
		  };

		  axios.post('${pageContext.request.contextPath}/calendar/listAjax.do', data)
		    .then(function(response) {
		      const res = response.data.list || response.data;
		      const list = res.content;
		      const container = document.querySelector(".search-list");
		      container.innerHTML = '';
		      console.log("list", list);

		      if (!Array.isArray(list) || list.length === 0) {
		        container.innerHTML = '<li class="li"><p>There are no registered schedules.</p></li>';
		        return;
		      }

		      list.forEach(function(event) {
		        console.log("서버 응답 데이터 전체:", response.data);
		        console.log("list 값:", list);
		        console.log("이벤트 객체:", event);

		        const startDateObj = new Date(event.startDatetime);
		        const endDateObj = new Date(event.endDatetime);
		        const today = new Date();
		        today.setHours(0, 0, 0, 0);

		        let status = "";
		        if (startDateObj > today) {
		          status = "UPCOMING";
		        } else if (startDateObj <= today && endDateObj >= today) {
		          status = "ONGOING";
		        } else {
		          status = "COMPLETED";
		        }

		        let badgeClass = "";
		        if (status === "ONGOING") {
		          badgeClass = "bg3";
		        } else if (status === "UPCOMING") {
		          badgeClass = "";
		        } else if (status === "COMPLETED") {
		          badgeClass = "bg2";
		        }

		        const startDate = startDateObj.toLocaleDateString();
		        const endDate = endDateObj.toLocaleDateString();
		        const id = event.id;

		        const li = document.createElement("li");
		        li.className = "li";
		        li.innerHTML = `
		          <div class="in">
		            <div class="card-top">
		              <span class="krds-badge ${badgeClass}">\${status}</span>
		            </div>
		            <div class="card-body" onclick="location.href='${pageContext.request.contextPath}/calendar/detail.do?id=${id}'" style="cursor:pointer;">
		              <div class="c-text">
		                <p class="c-tit"><span class="span">\${event.eventTitle}</span></p>
		                <p class="c-txt">\${event.eventDescription || ''}</p>
		                <p class="c-date">
		                  <strong class="key"></strong>
		                  <span class="value">\${startDate} ~ \${endDate}</span>
		                </p>
		              </div>
		            </div>
		          </div>
		        `;
		        container.appendChild(li);
		      });

		      document.querySelector("#divPagingArea").innerHTML = res.pagingArea;
		      bindPagingEvents();
		    })
		    .catch(function(error) {
		      console.error('일정 목록 불러오기 실패:', error);
		    });
		}

	
	function bindPagingEvents() {
	  document.querySelectorAll(".clsPagingArea").forEach(function (el) {
	    el.addEventListener("click", function (e) {
	      e.preventDefault();
	      const currentPage = parseInt(this.dataset.currentPage);
	      loadCalendarList(currentPage);
	    });
	  });
	}
	
function displayTodayEvents() {
  const onlistBox = document.querySelector(".ongoing");
  const uplistBox = document.querySelector(".upcoming");
  const ongoingCont = document.querySelector(".ongoingCont");
  const upcomingCont = document.querySelector(".upcomingCont");
  const clickCalendar = document.querySelector(".clickCalendar");
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  tomorrow.setHours(0, 0, 0, 0);
  const tomorrowEnd = new Date(tomorrow);
  tomorrowEnd.setHours(23, 59, 59, 999);

  onlistBox.innerHTML = '';
  uplistBox.innerHTML = '';
  ongoingCont.style.setProperty('display', 'none', 'important');
  upcomingCont.style.setProperty('display', 'none', 'important');
  clickCalendar.style.setProperty('display', 'none', 'important');

  allEvents.forEach(event => {
    const { title, start, end, extendedProps = {} } = event;
    const description = extendedProps.eventDescription || "";
    const organizer = extendedProps.organizer || "";
    const status = (extendedProps.eventStatus || "").toUpperCase();
  const fileList = extendedProps.fileDetailVOList || [];
  console.log("fileList check", fileList);
    //alert("extendedProps"+extendedProps)
	const id =  event.id
    if (!status || !(status === "ONGOING" || status === "UPCOMING")) return;
	let organizerClass = "";
	const organizerRaw = (extendedProps.organizer || "").toLowerCase();
	console.log("organizerRaw",organizerRaw)
	console.log("extendedProps",extendedProps)
	switch (organizerRaw) {
	  case "gini": 
		  organizerClass = "organizer-gini"; break;
	  case "city of daejeon":
	    organizerClass = "organizer-gini"; break;
	  case "city of dortmund":
	    organizerClass = "organizer-dortmund"; break;
	  case "city of malaga":
	    organizerClass = "organizer-malaga"; break;
	  case "county of montgomery, md":
	    organizerClass = "organizer-montgomery"; break;
	  case "city of seattle":
	    organizerClass = "organizer-seattle"; break;
	  case "province of quebec":
	    organizerClass = "organizer-quebec"; break;
	  default:
	    organizerClass = "organizer-default"; break;
	}
	const cls = organizerClass;

    let fileDownloadButton = "";
    if (fileList.length > 0) {
      const fileInfoList = fileList.map(f => ({
        name: f.fileOriginalName,
        path: f.fileSaveLocate
      }));
      const encodedFileInfoList = encodeURIComponent(JSON.stringify(fileInfoList));

      fileDownloadButton = `
        <div class="event-icon-box card-btn">
          <button type="button"
                  class="btn xsm btn-txt ico-down ico-before"
                  title="첨부파일 다운로드"
                  onclick="fn_dw(this)"
                  data-file-list="\${encodedFileInfoList}">
          </button>
        </div>
      `;
    }

    const template = `
      <div class="event-list-box \${status.toLowerCase()} top">
      <div class="event-list upcoming top">
      <p class="event-list-tit \${cls}">\${organizerRaw}</p>
      \${fileDownloadButton}
      </div>
      <div class="event-list ${status.toLowerCase()} bottom" style="margin-bottom: 20%;">
        <div class="side-bg card-body">
          <a href="#" class="c-text" style="cursor:pointer !important; " onclick="location.href='${pageContext.request.contextPath}/calendar/detail.do?id=\${id}'" >
            <p class="c-tit"><span class="span">\${title}</span></p>
            \${description 
            	  ? `<p class="c-txt">\${description.length > 50 ? description.substring(0, 50) + '...' : description}</p>` 
            	  : ''
            	}
            <p class="c-date">
              <strong class="key">
              </strong>
              <strong class="value">\${formatDateString(start)} ~ \${formatDateString(end)}</strong>
            </p>
          </a>
        </div>
      </div>`;

    if (status === "UPCOMING") {
      const startDate = new Date(start);
      if (startDate >= tomorrow && startDate <= tomorrowEnd) {
        uplistBox.insertAdjacentHTML("beforeend", template);
        upcomingCont.style.setProperty('display', 'block', 'important');
      }
    }

    if (status === "ONGOING") {
      onlistBox.insertAdjacentHTML("beforeend", template);
      ongoingCont.style.setProperty('display', 'block', 'important');
    }
  });
}


	// 캘린더 렌더 이후 자동 실행 보장
	function waitForCalendarReady(callback) {
	  function check() {
	    if (typeof allEvents !== 'undefined' && Array.isArray(allEvents) && allEvents.length > 0) {
	      callback();
	    } else {
	      setTimeout(check, 300);
	    }
	  }
	  check();
	}


	document.addEventListener("DOMContentLoaded", function() {
		  waitForCalendarReady(function() {
		    displayTodayEvents();
		  });
		});

	function fn_dw(el) {
		  const fileListStr = el.dataset.fileList;
		  if (!fileListStr) {
		    alert("다운로드할 파일이 없습니다.");
		    return;
		  }

		  let fileList;
		  try {
		    fileList = JSON.parse(decodeURIComponent(fileListStr));
		  } catch (e) {
		    alert("파일 정보 파싱 오류");
		    console.error(e);
		    return;
		  }

		  if (!Array.isArray(fileList) || fileList.length === 0) {
		    alert("파일 정보가 없습니다.");
		    return;
		  }

		  if (fileList.length >= 2) {
		    const params = fileList.map(f => `fileNames=\${encodeURIComponent(f.path)}`).join("&");
		    const url = `${pageContext.request.contextPath}/downloadMulti.do?\${params}`;
		    location.href = url;
		  } else {
		    const file = fileList[0];
		    const url = `${pageContext.request.contextPath}/download.do?fileName=\${encodeURIComponent(file.path)}&originalName=\${encodeURIComponent(file.name)}`;
		    location.href = url;
		  }
		}


</script>

