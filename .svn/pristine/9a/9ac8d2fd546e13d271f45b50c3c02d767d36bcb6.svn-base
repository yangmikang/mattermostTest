 <%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<html>
<c:if test="${not empty successMessage}">
    <script>
        alert("${successMessage}");
    </script>
</c:if>
<head>
<script> 
$(document).ready(function() {
	$('#city_code').on('change', function() {
	    if ($(this).val() === '99') {
	        $('#otherCityInput').show();
	    } else {
	        $('#otherCityInput').hide();
	    }
	});
	
	$(".btn-delete").click(function() {
		const userId = $("#userId").val();
        if(confirm("Are you sure you want to delete your account?")) {
          $.ajax({
            type: "POST",
            url: "${pageContext.request.contextPath}/deleteAccount.do",
            data: { id: userId },
			success: function(response) {
	            console.log("회원 삭제 성공:", userId);
	            location.href = "${pageContext.request.contextPath}/logout.do";
	          },
	          error: function(xhr, status, error) {
	            console.error("회원 삭제 실패:", error);
	          }
          });
        }
      });
}); 
function validateForm() {
	
    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const city_code = document.getElementById("city_code").value.trim();
    const city_etc = document.getElementById("city_etc").value.trim();

    if (city_code === "") {
        alert("Please select your city.");
        return false;
    }

    if (city_code === "99") {
        if (city_etc === "") {
            alert("Please enter your other city.");
            return false;
        }
        if (city_etc.length > 50) {
            alert("Other city name cannot exceed 50 characters.");
            return false;
        }
    }

    if (username === "") {
        alert("Please enter your name.");
        return false;
    }
    if (username.length < 2 || username.length > 20) {
        alert("Name must be between 2 and 20 characters.");
        return false;
    }

    if (email !== "") {
        if (email.length > 50) {
            alert("Email cannot exceed 50 characters.");
            return false;
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            alert("Please enter a valid email address.");
            return false;
        }
    }

    return true;
}
</script>
</head>
<div class="inner">
	<div class="login-form-area">
		<div class="login-wrap">
			<div class="conts-area">
				<fieldset>
					<legend>Edit User</legend>
						<form action="${pageContext.request.contextPath}/updateUser.do" method="post" onsubmit="return validateForm();">
						    <input type="hidden" name="id" id="userId" value="${user.id}" />
						    
						    <div class="form-group margin-b">
						        <div class="form-tit">
						            <label for="username">ID</label>
						        </div>
						        <div class="form-conts btn-ico-wrap">
						            ${user.id}  
						        </div>
						    </div>
						    
						    <div class="form-group margin-b">
						        <div class="form-tit">
						            <label for="username">User name</label>
						        </div>
						        <div class="form-conts btn-ico-wrap">
						            <input type="text" name="username" id="username" class="form-control" value="${user.username}">
						        </div>
						    </div>
						
						    <div class="form-group margin-b">
						        <div class="form-tit">
						            <label for="email">Email</label>
						        </div>
						        <div class="form-conts btn-ico-wrap">
						            <input type="email" name="email" id="email" class="form-control" value="${user.email}">
						        </div>
						    </div>
						
						    <div class="form-group margin-b">
						        <div class="form-tit">
						            <label for="city_code">City</label>
						        </div>
						        <div class="form-conts btn-ico-wrap">
						            <select class="form-select md" name="city_code" id="city_code">
						                <option value="">Select city</option>
						                <option value="01" ${user.city_code == '01' ? 'selected' : ''}>Daejeon</option>
						                <option value="02" ${user.city_code == '02' ? 'selected' : ''}>Dortmund</option>
						                <option value="03" ${user.city_code == '03' ? 'selected' : ''}>Malaga</option>
						                <option value="04" ${user.city_code == '04' ? 'selected' : ''}>Montgomery</option>
						                <option value="05" ${user.city_code == '05' ? 'selected' : ''}>Seattle</option>
						                <option value="06" ${user.city_code == '06' ? 'selected' : ''}>Quebec</option>
						                <option value="99" ${user.city_code == '99' ? 'selected' : ''}>Other city</option>
						            </select>
						        </div>
						        <div class="form-conts btn-ico-wrap" id="otherCityInput" style="display: ${user.city_code == '99' ? 'block' : 'none'};">
						            <input type="text" class="form-control" id="city_etc" name="city_etc" value="${user.city_etc}" placeholder="Enter Other City">
						        </div>
						    </div>
						
						    <div class="form-group">
						    	<a href="${pageContext.request.contextPath}/changePassword.do" class="btn">Change Password</a>
						        <button type="submit" class="btn primary">Update</button>
						        <a class="btn-delete btn" class="btn">Delete Account</a>
						    </div> 
						</form>
					</fieldset>
				</div>
			</div>
		</div>
	</div>
	<!-- //컨텐츠 영역 -->
</body>

</html>