<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>

<!DOCTYPE html>
<html>
<head>
<title>Insert title here</title>
</head>
<style>
		#content{
		    width: 80%;
    		margin: 0 auto;
			margin-bottom: 5%;
			margin-top: 2%;
	}
	.subBt, .fileIp {
		display: none ; 
	}
	td> .ip {
	width:50%;}


form  button{

border: 1px solid black;
width: 80px;
height: 30px;

}
</style>

		
	
<body>
  
  <form class="form-horizontal" id="form" action="/contract/create"
	method="post" enctype="multipart/form-data">
	<div id="content">
	 <input type="hidden" name="fileGroupNo" value="${boardVo.fileGroupNo}" />
  <h2>Board Detail</h2>
		<h6 class="mb-4"></h6>
		<table class="table table-bordered">
			<tbody class="contb">
					<input type="hidden" class="ip" name="boardCode"
						value="${boardVo.boardCode}" id="" readonly>
				<tr>
					<th scope="row">1</th>
					<td>Author</td>
					<td><input type="text" class="ip" name=""
						value="${boardVo.username}" id="" readonly></td>
				</tr>
				<tr>
					<th scope="row">2</th>
					<td>Title</td>
					<td><input type="text" id="boardIP" name="title" class="updtcon ip" 
						value="${boardVo.title}" readonly></td>
				</tr>
				<tr>
					<th scope="row">3</th>
					<td>Content</td>
					<td>
					<textarea rows="5" cols="20" name="content" class="updtcon ip" readonly>${boardVo.content}</textarea>
					
					
				</tr>
				<tr>
					<th scope="row">4</th>
					<td>Reg Date</td>
					<td><input type="text" id="" name="" class="ip"
						value="${boardVo.regDate}"  readonly></td>
				</tr>
					<tr class="fileIp">
					<th scope="row">7</th>
					<td>Upload File</td>
					<td>
						<input type="file" name="uploadFiles">	
					</td>
				</tr>
	<c:if test="${boardVo.fileGroupVO != null}">
    <c:forEach var="fileDetailVO" items="${boardVo.fileGroupVO.fileDetailVOList}" varStatus="stat">
        <tr>
            <th scope="row">12</th>
            <td>첨부파일</td>
            <td colspan="2">
               <img class="img-fluid imgFileSaveLocate"
                     style="cursor: pointer; display: none;" src="${fileDetailVO.fileSaveLocate}"
                     data-file-original-name="${fileDetailVO.fileOriginalName}"
                     data-file-save-locate="${fileDetailVO.fileSaveLocate}" /> 
               <!--  <button type="button"  class="prev" >미리보기</button> -->
                <button type="button" class="down" onclick="fn_dw()">다운로드</button>
            </td>
        </tr>
        <tr>
       <%--      <td colspan="4">
                    <div class="mgmodal">
                        <div class="delmodal">&times;</div>
                        <div class="mdimg">
                            <img class="img-fluid"
                                 style="cursor: pointer;"
                                 src="${fileDetailVO.fileSaveLocate}" />
                        </div>
                    </div>
            </td> --%>
        </tr>
    </c:forEach>
</c:if>




			</tbody>
		</table>
		
	<button type="button"  class="edit" onclick="updateBd()">수정</button>
	<button type="submit" class="subBt"  >확인</button>
	<button type="button"  class="delete" onclick="deleteBd()">삭제</button>
	<button type="button"  class="list"><a href="/distep/board/home.do">목록</a></button>
</form>
<script type="text/javascript">
  // 전역 함수로 선언 (HTML onclick에서도 접근 가능)
  function updateBd() {
    let edit = document.querySelector(".edit")
    let down =document.querySelector(".down")
    let prev =document.querySelector(".prev")
    let sub =document.querySelector(".subBt")
    let fileIp =document.querySelector(".fileIp")

    console.log("수정",edit)
    console.log("삭제",sub)
	const displayVal = window.getComputedStyle(fileIp).display;
	console.log("fileIp display:", displayVal);

  
  if (edit) edit.style.display = 'none';
  if (down) down.style.display = 'none';
  if (prev) prev.style.display = 'none';
  if (sub) sub.style.display = 'block';
  if (fileIp) fileIp.style.display = 'table-row';
			
    document.querySelectorAll(".updtcon").forEach(function (el) {
      el.removeAttribute("readonly");
      el.style.border = "1px solid gray";
    });

    const form = document.getElementById("form");
    form.setAttribute("action", "/distep/board/update.do");
    form.setAttribute("method", "post");
  }

  function deleteBd() {
    const form = document.getElementById("form");
    form.setAttribute("action", "/distep/board/delete.do");

    const result = confirm("삭제하시겠습니까?");
    if (result) {
      form.submit();
    } else {
      alert("삭제 취소되었습니다");
    }
  }

 function fn_dw() {
    // 다운로드 버튼 이벤트
      const target = document.querySelector(".imgFileSaveLocate");

      if (target) {
        const fileSaveLocate = target.dataset.fileSaveLocate;
        console.log("fileSaveLocate : " + fileSaveLocate);
        location.href = "/distep/download.do?fileName=" + encodeURIComponent(fileSaveLocate);
      } else {
        console.warn("❌ .imgFileSaveLocate 요소를 찾을 수 없습니다.");
      }
    
  };
</script>
</body>
</html>
