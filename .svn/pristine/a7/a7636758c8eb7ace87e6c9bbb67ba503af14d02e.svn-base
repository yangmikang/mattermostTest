<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>

<!DOCTYPE html>
<html>
<head>
<title>Insert title here</title>
</head>
<style>
		#content{
		    width: 80%;
    		margin: 0 auto;
			margin-bottom: 5%;
			margin-top: 2%;
	}
	.subBt, .fileIp {
		display: none ; 
	}
	td> .ip {
	width:50%;}


form  button{

border: 1px solid black;
width: 80px;
height: 30px;

}
</style>

		
	
<body>
		<!-- 컨테이너 영역 -->
		<div id="container">
			<!-- breadcrumb -->
				<!-- 컨테이너 영역 -->
		
	<div class="page-title-wrap visual img-members">
	<div class="visual-filter"></div>
	<div class="inner">
		<!-- breadcrumb -->
		<nav class="breadcrumb-wrap" aria-label="브레드크럼">
			<ol class="breadcrumb">
				<li class="home"><a href="#" class="txt">Home</a></li>
				<li><a href="#" class="txt">Board</a></li>

				<c:choose>
				  <c:when test="${boardVo.boardMasterCode eq 'N01'}">
				    <li><a href="#" class="txt">GINI News</a></li>
				  </c:when>
				  <c:when test="${boardVo.boardMasterCode eq 'N02'}">
				    <li><a href="#" class="txt">Members News</a></li>
				  </c:when>
				  <c:when test="${boardVo.boardMasterCode eq 'N03'}">
				    <li><a href="#" class="txt">Media Release</a></li>
				  </c:when>
				  <c:when test="${boardVo.boardMasterCode eq 'N04'}">
				    <li><a href="#" class="txt">Q&A</a></li>
				  </c:when>
				  <c:when test="${boardVo.boardMasterCode eq 'N05'}">
				    <li><a href="#" class="txt">Members</a></li>
				  </c:when>
				  <c:when test="${boardVo.boardMasterCode eq 'N06'}">
				    <li><a href="#" class="txt">Action Group</a></li>
				  </c:when>
				  <c:when test="${boardVo.boardMasterCode eq 'A01'}">
				    <li><a href="#" class="txt">Publications</a></li>
				  </c:when>
				  <c:otherwise>
				    <li><a href="#" class="txt">Board</a></li>
				  </c:otherwise>
				</c:choose>

			</ol>
		</nav>

		<!-- 제목 영역 -->
		<div class="visual-area">
			<h2 class="h-tit">
			  <c:choose>
			    <c:when test="${boardVo.boardMasterCode eq 'N01'}">GINI News Detail</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N02'}">Members News Detail</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N03'}">Media Release Detail</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N04'}">Q&A Detail</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N05'}">Members Detail</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N06'}">Action Group Detail</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'A01'}">Publications Detail</c:when>
			    <c:otherwise>Board</c:otherwise>
			  </c:choose>
			</h2>

			<p>
			  <c:choose>
			    <c:when test="${boardVo.boardMasterCode eq 'N01'}">Stay updated with the latest announcements from GINI.</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N02'}">Get the latest updates and news from our members.</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N03'}">Browse official media releases and announcements.</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N04'}">Find answers to frequently asked questions.</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N05'}">Explore member profiles and collaboration details.</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'N06'}">Discover events and initiatives from action groups.</c:when>
			    <c:when test="${boardVo.boardMasterCode eq 'A01'}">Discover events and initiatives from action groups.</c:when>
			    <c:otherwise>Check the details of the post below.</c:otherwise>
			  </c:choose>
			</p>

		</div>
	</div>
</div>
			<!-- breadcrumb -->
  	
  <form class="form-horizontal" id="form" action="/contract/create"
	method="post" enctype="multipart/form-data">
	
	<input type="hidden" name="fileGroupNo" value="${boardVo.fileGroupNo}" />
	
	<input type="hidden" class="boardCode" id="boardCode"name="boardCode"
						value="${boardVo.boardCode}" id="" readonly>
	<input type="hidden" class="ip" name=""
						value="${boardVo.cityCode}" id="" readonly>
			<!-- 컨텐츠 영역 -->
			<div class="inner">
				<!-- 페이지 타이틀 영역 -->
				<!-- //페이지 타이틀 영역 -->
				<!-- 상세보기 영역 -->
				<div class="conts-area">
					<div class="conts-detail-wrap txt-box bg-white">
						<!-- real contents -->
						<div class="conts-wrap scroll-check">
							<div class="conts-wrap section-link" id="section_01">
								<h3 class="sec-tit">
								<input type="text" id="boardIP" name="title" style="width:1200px; border:none;" class="updtcon ip title" value="${boardVo.title}" readonly></h3>
								<!-- table list -->
								<div class="tbl-wrap">
									<dl class="tbl def-list">
										<!-- <dt>Title</dt>
										<dd><h3 class="sec-tit">제목입력해주세요</h3></dd> -->
										<dt>Author</dt>
										
										<dd  style=" display: flex; align-items: center;">
										  <c:choose>
										    <c:when test="${boardVo.cityCode == '01'}">
										      <!-- Daejeon / South Korea -->
										      <img src="${pageContext.request.contextPath}/img/component/common/ico_korea.svg" alt="Korea Flag" />
										    </c:when>
										    <c:when test="${boardVo.cityCode == '02'}">
										      <!-- Dortmund / Germany -->
										      <img src="${pageContext.request.contextPath}/img/component/common/ico_germany.svg" alt="Germany Flag" />
										    </c:when>
										    <c:when test="${boardVo.cityCode == '03'}">
										      <!-- Malaga / Spain -->
										      <img src="${pageContext.request.contextPath}/img/component/common/ico_spain.svg" alt="Spain Flag" />
										    </c:when>
										    <c:when test="${boardVo.cityCode == '04' || boardVo.cityCode == '05'}">
										      <!-- Montgomery County / Seattle => USA -->
										      <img src="${pageContext.request.contextPath}/img/component/common/ico_usa.svg" alt="USA Flag" />
										    </c:when>
										    <c:when test="${boardVo.cityCode == '06'}">
										      <!-- Quebec / Canada -->
										      <img src="${pageContext.request.contextPath}/img/component/common/ico_canada.svg" alt="Canada Flag" />
										    </c:when>
										    <c:otherwise>
										      <!-- Other / Unknown -->
										      <img src="${pageContext.request.contextPath}/img/component/common/ico_global.svg" alt="Global Flag" />
										    </c:otherwise>
										    </c:choose>
											${boardVo.username}</dd>
										<dt>Reg Date</dt>
										<dd>${boardVo.regDate}</dd>
										<dt>Content</dt>
										<dd>
										<c:if test="${boardVo.fileGroupVO != null}">
									    <c:forEach var="fileDetailVO" items="${boardVo.fileGroupVO.fileDetailVOList}" varStatus="stat">
									        <c:if test="${fileDetailVO.fileType == 'THUMBNAIL'}">
									            <tr>
									                <td colspan="2">
									                    <img class="img-fluid imgFileSaveLocate"
									                         style="cursor: pointer; display: block;"
									                         src="${pageContext.request.contextPath}/${fileDetailVO.fileSaveLocate}"
									                         data-file-original-name="${fileDetailVO.fileOriginalName}"
									                         data-file-save-locate="${fileDetailVO.fileSaveLocate}" /> 
									                </td>
									            </tr>
										
										    </c:if>
    </c:forEach>
</c:if>
<div>

</div>
</dd>
						<div id="thumbCont" style="display:none ">
									<dt class="form-tit thumbnail-field">
										</dt>
										<dd class="thumbnail-field">
										    <div class="form-group margin-b">
										        <div class="form-tit lg">
										            <label for="">Upload Thumbnail</label>
										        </div>
										        <div class="form-conts row">
										            <input id="fileNm" type="text" maxlength="16" class="form-control" placeholder="Thumbnail file name" readonly>
										            <button type="button" class="btn lg secondary" onclick="document.getElementById('thumbnail').click()"> Search </button>
										        </div>
										        <p class="form-hint info">Allow up to 00 bytes</p>
										        <input type="file" name="thumbnailFile" id="thumbnail" style="display:none;" onchange="setThumbnailFileName()"  />  
										    </div>
										</dd>
										</div>
										<textarea rows="10" cols="100" name="content" class="updtcon content" readonly style="border:none;">${boardVo.content}</textarea>
										</dd>
										<c:if test="${boardVo.fileGroupVO != null}">
										<dt style="display: block; width: 100%;">Upload File</dt>
										   <c:forEach var="fileDetailVO" items="${boardVo.fileGroupVO.fileDetailVOList}" varStatus="stat">
											  <c:if test="${fileDetailVO.fileType eq 'GENERAL'}">
											    <td colspan="2">
											      <img class="img-fluid imgFileSaveLocate" style="display: none;" 
											           src="<c:url value='${fileDetailVO.fileSaveLocate}' />"
											           data-file-original-name="${fileDetailVO.fileOriginalName}"
											           data-file-save-locate="${fileDetailVO.fileSaveLocate}" />
											    </td>
											    <dd>
											      <ul class="box-group-area">
											        <li>
											          <p class="tit">${fileDetailVO.fileOriginalName} [${fileDetailVO.fileExt}, ${fileDetailVO.fileFancySize}]</p>
											          <div class="btn-wrap">
											            <button type="button" class="btn sm btn-txt ico-down down" onclick="fn_dw()">Download</button>
											          </div>
											        </li>
											      </ul>
											      <input type="hidden" name="existingFileIds" value="${fileDetailVO.fileGroupNo}" />
											    </dd>
											  </c:if>
											</c:forEach>

										</c:if>
								</div>
								
								<div class="gini-cont-box" style="display:none;">
						<div class="row">
							<!-- 파일업로드 -->
							<div class="file-upload cont50" ondragover="f_over()"   ondrop="f_drop()">
								<p class="txt">Please drag and drop the file you wish to attach here, or click the Select File button to select the file directly.</p>
								<button type="button" class="btn primary ico-before ico-upload md" onclick="document.getElementById('uploadFiles').click()">
Select file</button>
							
							<input type="file" name="uploadFiles" multiple id="uploadFiles"style="display:none;" onchange="handleFileUpload(event)" />
							</div>
							<!-- //파일업로드 -->
							<!-- 파일업로드 -->
							<div class="file-upload-result cont50">
								<div class="upload-top">
									<div class="file-total"><span class="current">0개</span> / 6개(몇개로 할지 협의 필요)</div>
								</div>
								<ul class="upload-list" id="fileListArea">
								</ul>
								<div class="upload-delete-btn">
									<button type="button" class="btn btn-txt ico-before ico-del sm h-auto " onclick="deleteAllFiles()">delete all</button>
								</div>
							</div>
							<!-- //파일업로드 리스트 -->
						</div>
						
					</div>
					
					
            <%-- 
            <tr>
                <td colspan="4">
                    <div class="mgmodal">
                        <div class="delmodal">&times;</div>
                        <div class="mdimg">
                            <img class="img-fluid"
                                 style="cursor: pointer;"
                                 src="${fileDetailVO.fileSaveLocate}" />
                        </div>
                    </div>
                </td>
            </tr>
            --%>
    

					
								<!-- //table list -->
							</div>
							
						</div>
						<!-- //real contents -->
						 <div class="page-btn-wrap both">
							<div>
							
							 <c:choose>
										    <c:when test="${boardVo.boardMasterCode == 'N01'}">
										      <!-- Daejeon / South Korea -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=N01'">Go to list</button>
										    </c:when>
										    <c:when test="${boardVo.boardMasterCode == 'N02'}">
										      <!-- Dortmund / Germany -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=N02'">Go to list</button>
										    </c:when>
										    <c:when test="${boardVo.boardMasterCode == 'N03'}">
										      <!-- Malaga / Spain -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=N03'">Go to list</button>
										    </c:when>
										    <c:when test="${boardVo.boardMasterCode == 'N04'}">
										      <!-- Malaga / Spain -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=N04'">Go to list</button>
										    </c:when>
										    <c:when test="${boardVo.boardMasterCode == 'N05'}">
										      <!-- Malaga / Spain -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=N05'">Go to list</button>
										    </c:when>
										    <c:when test="${boardVo.boardMasterCode == 'N06'}">
										      <!-- Malaga / Spain -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=N06'">Go to list</button>
										    </c:when>
										    <c:when test="${boardVo.boardMasterCode == 'A01'}">
										      <!-- Malaga / Spain -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=A01'">Go to list</button>
										    </c:when>
										    <c:otherwise>
										      <!-- Other / Unknown -->
											<button type="button" class="btn xlg" onclick="location.href='${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=N01'">Go to list</button>
										    </c:otherwise>
										    </c:choose>
							</div>
							<div>
							<input type="hidden" name="boardMasterCode" value="..."/>
								<input type="checkbox" name="deleteFileIds" value="${fileDetailVO.fileNo}" />
								<button type="button" class="btn xlg edit" onclick="updateBd()">Edit</button>
								<button type="submit" class="btn xlg subBt" >Submit</button>
								<button type="button" class="btn xlg tertiary delete" onclick="deleteBd()">Delete</button>
							</div>
						</div>
					</div><input type="hidden" name="boardMasterCode"  id="boardMasterCode" value="${boardVo.boardMasterCode}" />
					
				</div>



				<!-- //상세보기 영역 -->
			</div>
		<!-- //컨테이너 영역 -->

		
	</div>
</form><%-- <c:forEach var="file" items="${fileList}">
    <c:if test="${file.fileType == 'THUMBNAIL'}">
        <!-- 썸네일 파일 출력 -->
        <img src="${pageContext.request.contextPath}/file/download.do?fileId=${file.fileSn}" alt="썸네일" />
    </c:if>
</c:forEach>
 --%>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>	
<script type="text/javascript">

//location.href = encodeURI(`${fileDetailVO.fileSaveLocate}`);

//전역 파일 저장 배열
let uploadedFiles = [];
function setThumbnailFileName() {
    const fileInput = document.getElementById("thumbnail");
    const fileNameInput = document.getElementById("fileNm");

    if (fileInput.files.length > 0) {
        const fileName = fileInput.files[0].name;
        fileNameInput.value = fileName;
    } else {
        fileNameInput.value = "";
    }
}

function formatBytes(bytes) {
  if (bytes === 0) return '0KB';
  const k = 1024;
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  const size = parseFloat((bytes / Math.pow(k, i)).toFixed(1));
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  return `\${size} \${sizes[i]}`;
}

function updateFileCount() {
  const countSpan = document.querySelector('.file-total .current');
  const validCount = uploadedFiles.length;
  countSpan.textContent = `\${validCount}개`;
}

function deleteAllFiles() {
  uploadedFiles = [];
  const fileListArea = document.getElementById('fileListArea');
  fileListArea.innerHTML = '';
  updateFileCount();
}

function handleFileUpload(event) {
  const files = event.target.files;
  const fileListArea = document.getElementById('fileListArea');

  for (let i = 0; i < files.length; i++) {
    const file = files[i];

    if (file.size > 20 * 1024 * 1024) {
      const li = document.createElement('li');
      li.classList.add('is-error');
      li.innerHTML = `
        <div class="in">
          <div class="file-name">\${file.name} [\${file.name.split('.').pop()}, \${formatBytes(file.size)}]</div>
          <div class="file-btn">
            <span class="ico-invalid error"><em class="sr-only">에러</em></span>
            <button type="button" class="btn btn-txt ico-before ico-del sm h-auto" onclick="this.closest('li').remove(); updateFileCount();">삭제</button>
          </div>
        </div>
        <p class="file-hint">등록 가능한 파일 용량을 초과하였습니다.<br>20MB 미만의 파일만 등록할 수 있습니다.</p>
      `;
      fileListArea.appendChild(li);
      continue;
    }

    if (uploadedFiles.length >= 6) {
      alert("최대 6개의 파일만 등록할 수 있습니다.");
      break;
    }

    uploadedFiles.push(file);

    const li = document.createElement('li');
    li.innerHTML = `
      <div class="in">
        <div class="file-name">\${file.name} [\${file.name.split('.').pop()}, \${formatBytes(file.size)}]</div>
        <div class="file-btn">
          <button type="button" class="btn btn-txt ico-before ico-del sm h-auto" onclick="this.closest('li').remove(); updateFileCount();">삭제</button>
        </div>
      </div>
    `;
    fileListArea.appendChild(li);
  }

  updateFileCount();
  //event.target.value = '';
}

function deleteSingleFile(index, button) {
  uploadedFiles.splice(index, 1);
  button.closest('li').remove();
  updateFileCount();
}


  // 전역 함수로 선언 (HTML onclick에서도 접근 가능)
  function updateBd() {
	  document.querySelector(".edit").style.display = 'none';
	  document.querySelector(".subBt").style.display = 'inline-flex';
	  document.querySelector(".gini-cont-box").style.display = 'block';
	  document.querySelector("#thumbCont").style.display = 'block';

	  document.querySelectorAll(".updtcon").forEach(function (el) {
	    el.removeAttribute("readonly");
	    el.style.border = "1px solid gray";
	  });

	  const form = document.getElementById("form");
	  form.setAttribute("action", "${pageContext.request.contextPath}/board/update.do");
	  form.setAttribute("method", "post");
  }

  function deleteBd() {
	  const result = confirm("삭제하시겠습니까?");
	  if (!result) {
	    alert("삭제 취소되었습니다");
	    return;
	  }

	  const boardCode = document.getElementById("boardCode").value;
	  const boardMasterCode = document.getElementById("boardMasterCode").value;

	  axios.post(`${pageContext.request.contextPath}/board/delete.do`, {
	    boardCode: boardCode,
	    boardMasterCode: boardMasterCode
	  })
	  .then(res => {
	    const redirectUrl = res.data;
	    alert("삭제되었습니다.");
	    
	    
	    location.href = `${pageContext.request.contextPath}/board/boardList.do?boardMasterCode=\${boardMasterCode}`;
	  })
	  .catch(error => {
	    console.error("삭제 오류:", error);
	    alert("삭제 실패");
	  });
	}





 function fn_dw() {
    // 다운로드 버튼 이벤트
      const target = document.querySelector(".imgFileSaveLocate");

      if (target) {
        const fileSaveLocate = target.dataset.fileSaveLocate;
        console.log("fileSaveLocate : " + fileSaveLocate);
        location.href = "${pageContext.request.contextPath}/download.do?fileName=" + encodeURIComponent(fileSaveLocate);
      } else {
        console.warn(".imgFileSaveLocate 요소를 찾을 수 없습니다.");
      }
    
  };
</script>
</body>
</html>
